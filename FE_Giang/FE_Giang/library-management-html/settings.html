<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C√†i ƒê·∫∑t - Sarly Library</title>
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700;900&family=Noto+Serif:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS -->
  <link rel="stylesheet" href="./assets/css/variables.css">
  <link rel="stylesheet" href="./assets/css/global.css">
  <link rel="stylesheet" href="./assets/css/components.css">
  <link rel="stylesheet" href="./assets/css/layout.css">
  <link rel="stylesheet" href="./assets/css/responsive.css">
  <link rel="stylesheet" href="./assets/css/pages/settings.css">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="layout">
    <div class="layout-content" id="layoutContent">
      <main class="main-content">
        <div class="content-header">
          <div class="content-header-top">
            <h2 class="content-title">C√†i ƒê·∫∑t</h2>
          </div>
          <p class="content-description">Qu·∫£n l√Ω th√¥ng tin c√° nh√¢n v√† t√πy ch·ªânh h·ªá th·ªëng</p>
        </div>

        <div class="row">
          <!-- Profile Information -->
          <div class="col col-md-6">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Th√¥ng Tin C√° Nh√¢n</h3>
              </div>
              <div class="card-body">
                <form id="profileForm">
                  <div class="form-group">
                    <label for="name" class="form-label required">H·ªç v√† t√™n</label>
                    <input type="text" id="name" class="form-control" required>
                  </div>

                  <div class="form-group">
                    <label for="email" class="form-label required">Email</label>
                    <input type="email" id="email" class="form-control" required disabled>
                    <span class="form-text">Email kh√¥ng th·ªÉ thay ƒë·ªïi</span>
                  </div>

                  <div class="form-group">
                    <label for="role" class="form-label">Vai tr√≤</label>
                    <input type="text" id="role" class="form-control" disabled>
                  </div>

                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i>
                    L∆∞u thay ƒë·ªïi
                  </button>
                </form>
              </div>
            </div>
          </div>

          <!-- Change Password -->
          <div class="col col-md-6">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">ƒê·ªïi M·∫≠t Kh·∫©u</h3>
              </div>
              <div class="card-body">
                <form id="passwordForm">
                  <div class="form-group">
                    <label for="currentPassword" class="form-label required">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                    <input type="password" id="currentPassword" class="form-control" required>
                  </div>

                  <div class="form-group">
                    <label for="newPassword" class="form-label required">M·∫≠t kh·∫©u m·ªõi</label>
                    <input type="password" id="newPassword" class="form-control" required minlength="6">
                    <span class="form-text">T·ªëi thi·ªÉu 6 k√Ω t·ª±</span>
                  </div>

                  <div class="form-group">
                    <label for="confirmPassword" class="form-label required">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                    <input type="password" id="confirmPassword" class="form-control" required>
                  </div>

                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-key"></i>
                    ƒê·ªïi m·∫≠t kh·∫©u
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- System Preferences -->
        <div class="row">
          <div class="col col-12">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">T√πy Ch·ªânh H·ªá Th·ªëng</h3>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col col-md-6">
                    <div class="form-group">
                      <label for="language" class="form-label">Ng√¥n ng·ªØ</label>
                      <select id="language" class="form-control">
                        <option value="vi" selected>Ti·∫øng Vi·ªát</option>
                        <option value="en">English</option>
                      </select>
                    </div>
                  </div>

                  <div class="col col-md-6">
                    <div class="form-group">
                      <label for="theme" class="form-label">Giao di·ªán</label>
                      <select id="theme" class="form-control">
                        <option value="light" selected>S√°ng</option>
                        <option value="dark">T·ªëi</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="form-check">
                  <input type="checkbox" id="notifications" class="form-check-input" checked>
                  <label for="notifications" class="form-check-label">
                    Nh·∫≠n th√¥ng b√°o t·ª´ h·ªá th·ªëng
                  </label>
                </div>

                <div class="form-check">
                  <input type="checkbox" id="emailNotifications" class="form-check-input" checked>
                  <label for="emailNotifications" class="form-check-label">
                    Nh·∫≠n th√¥ng b√°o qua email
                  </label>
                </div>

                <button class="btn btn-primary mt-3" onclick="savePreferences()">
                  <i class="fas fa-save"></i>
                  L∆∞u c√†i ƒë·∫∑t
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- About -->
        <div class="row">
          <div class="col col-12">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">V·ªÅ H·ªá Th·ªëng</h3>
              </div>
              <div class="card-body">
                <div style="text-align: center; padding: 2rem;">
                  <div style="font-size: 4rem; margin-bottom: 1rem;">üìö</div>
                  <h2 style="color: var(--primary-color); margin-bottom: 0.5rem;">Sarly</h2>
                  <p style="color: var(--text-secondary); margin-bottom: 2rem;">Vintage Library Management System</p>
                  
                  <div style="display: inline-block; text-align: left;">
                    <p><strong>Phi√™n b·∫£n:</strong> 1.0.0</p>
                    <p><strong>Ng√†y ph√°t h√†nh:</strong> December 2025</p>
                    <p><strong>Backend API:</strong> <code>http://localhost:8086</code></p>
                    <p><strong>C√¥ng ngh·ªá:</strong> HTML, CSS, JavaScript, Chart.js</p>
                  </div>

                  <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                    <p style="color: var(--text-light);">&copy; 2025 Sarly. All rights reserved.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Scripts -->
  <script src="./assets/js/utils.js"></script>
  <script src="./assets/js/api.js"></script>
  <script src="./assets/js/auth.js"></script>
  <script src="./assets/js/components.js"></script>
  
  <script>
    // Protect page
    if (!protectPage()) {
      throw new Error('Unauthorized');
    }

    // Initialize page
    async function initSettings() {
      try {
        // Insert sidebar and header
        const sidebarHTML = Components.getSidebarHTML();
        const headerHTML = Components.getHeaderHTML('C√†i ƒê·∫∑t', [
          { text: 'Trang ch·ªß', href: '/dashboard.html' },
          { text: 'C√†i ƒë·∫∑t' }
        ]);

        document.querySelector('.layout').insertAdjacentHTML('afterbegin', sidebarHTML);
        document.getElementById('layoutContent').insertAdjacentHTML('afterbegin', headerHTML);

        // Initialize components
        Components.initSidebar();
        Components.initHeader();
        Auth.init();
        Auth.setupLogoutButtons();

        // Load user profile
        await loadProfile();

        // Setup forms
        setupForms();

      } catch (error) {
        console.error('Settings init error:', error);
        Toast.error('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu');
      }
    }

    // Load user profile
    async function loadProfile() {
      try {
        const user = Auth.getCurrentUser();
        
        if (user) {
          document.getElementById('name').value = user.name || '';
          document.getElementById('email').value = user.email || '';
          document.getElementById('role').value = user.role || 'GUEST';
        }

      } catch (error) {
        console.error('Load profile error:', error);
      }
    }

    // Setup forms
    function setupForms() {
      // Profile form
      document.getElementById('profileForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const nameInput = document.getElementById('name');
        
        if (!Validator.validateRequired(nameInput, 'H·ªç v√† t√™n')) {
          return;
        }

        Toast.info('Ch·ª©c nƒÉng c·∫≠p nh·∫≠t profile ch∆∞a ƒë∆∞·ª£c implement ·ªü backend');
        
        // Uncomment when API is ready:
        // try {
        //   Loading.show();
        //   await AuthAPI.updateProfile({ name: nameInput.value });
        //   await Auth.refreshProfile();
        //   Toast.success('C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!');
        //   Loading.hide();
        // } catch (error) {
        //   Loading.hide();
        //   Toast.error(error.message);
        // }
      });

      // Password form
      document.getElementById('passwordForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const currentPassword = document.getElementById('currentPassword');
        const newPassword = document.getElementById('newPassword');
        const confirmPassword = document.getElementById('confirmPassword');

        Validator.clearAllErrors(e.target);

        let isValid = true;
        if (!Validator.validateRequired(currentPassword, 'M·∫≠t kh·∫©u hi·ªán t·∫°i')) isValid = false;
        if (!Validator.validateMinLength(newPassword, 6, 'M·∫≠t kh·∫©u m·ªõi')) isValid = false;
        if (!Validator.validateMatch(newPassword, confirmPassword, 'M·∫≠t kh·∫©u')) isValid = false;

        if (!isValid) return;

        Toast.info('Ch·ª©c nƒÉng ƒë·ªïi m·∫≠t kh·∫©u ch∆∞a ƒë∆∞·ª£c implement ·ªü backend');

        // Uncomment when API is ready:
        // try {
        //   Loading.show();
        //   await AuthAPI.changePassword({
        //     currentPassword: currentPassword.value,
        //     newPassword: newPassword.value
        //   });
        //   Toast.success('ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!');
        //   e.target.reset();
        //   Loading.hide();
        // } catch (error) {
        //   Loading.hide();
        //   Toast.error(error.message);
        // }
      });
    }

    // Save preferences
    function savePreferences() {
      const language = document.getElementById('language').value;
      const theme = document.getElementById('theme').value;
      const notifications = document.getElementById('notifications').checked;
      const emailNotifications = document.getElementById('emailNotifications').checked;

      // Save to localStorage
      Storage.set('preferences', {
        language,
        theme,
        notifications,
        emailNotifications
      });

      Toast.success('ƒê√£ l∆∞u c√†i ƒë·∫∑t th√†nh c√¥ng!');
      
      // Apply theme (simple implementation)
      if (theme === 'dark') {
        Toast.info('Giao di·ªán t·ªëi s·∫Ω ƒë∆∞·ª£c √°p d·ª•ng trong phi√™n b·∫£n ti·∫øp theo');
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initSettings);
  </script>
</body>
</html>
